create or replace procedure inserir_operacao_rega (
    p_id_operacao OPERACAO.id_operacao%type,
    p_id_parcela OPERACAO.id_parcela%type,
    p_id_rega OPERACAO_REGA.ID_REGA%type,
    p_data_operacao OPERACAO.data_operacao%type,
    p_tipo OPERACAO.tipo%type,
    p_quantidade OPERACAO.QUANTIDADE%type,
    p_unidade OPERACAO.UNIDADE%type,
    p_forma OPERACAO_REGA.FORMA_APLICACAO%type,
    p_id_sistema OPERACAO_REGA.ID_SISTEMA%type)
as
    v_id_operacao OPERACAO.ID_OPERACAO%type;
begin
    if (p_tipo != 'r') then
        raise_application_error(-20000, 'Tipo de Operacao Invalido!');
    end if;

    if (p_id_operacao is null) then
        raise_application_error(-20000, 'Id Operacao nao pode ser null!');
    end if;

    insert into OPERACAO(id_operacao, id_parcela, data_operacao, unidade, quantidade, tipo)
    values (p_id_operacao, p_id_parcela, p_data_operacao, p_unidade, p_quantidade, p_tipo);

    select ID_OPERACAO into v_id_operacao from OPERACAO where ID_OPERACAO = p_id_operacao;

    if (v_id_operacao is null) then
        raise_application_error(-20000, 'Dados Invalidos!');
    end if;

    insert into OPERACAO_REGA(id_operacao, id_rega, forma_aplicacao, id_sistema)
    VALUES (p_id_operacao,p_id_rega, p_forma, p_id_sistema);

    dbms_output.put_line('Operacao Concluida');
end;
/